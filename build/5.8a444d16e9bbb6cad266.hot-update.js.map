{"version":3,"file":"5.8a444d16e9bbb6cad266.hot-update.js","sources":["webpack:///src/containers/AdminAreaDealsTableContainer.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { observer } from 'mobx-react';\nimport { withStyles } from 'material-ui/styles';\nimport { DotLoader } from 'react-spinners';\nimport moment from 'moment';\nimport Papa from 'papaparse';\nimport AdminAreaDealsTable from '../components/AdminAreaDealsTable';\nimport debounce from '../utils/debounce';\nimport { capitalize } from '../utils/stringUtils';\nimport { padStringToDecimalString } from '../utils/Math';\n\n\nconst Loader = DotLoader;\n\nconst styles = theme => ({\n  root: {\n    position: 'relative',\n  },\n  progress: {\n    margin: theme.spacing.unit * 2,\n    marginRight: 'auto',\n    marginLeft: 'auto',\n    display: 'block',\n  },\n  progressWrapper: {\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    flexDirection: 'column',\n    padding: '60px 20px',\n    borderRadius: '3px',\n    backgroundColor: '#fff',\n    zIndex: 2,\n  },\n});\n\nconst columns = [\n  { name: 'dealID', title: 'Deal ID' },\n  { name: 'date', title: 'Date' },\n  { name: 'agentName', title: 'Agent Name' },\n  { name: 'agentType', title: 'Agent Type' },\n  { name: 'dealType', title: 'Deal Type' },\n  { name: 'clientName', title: 'Client Name' },\n  { name: 'clientEmail', title: 'Client Email' },\n  { name: 'propertyAddress', title: 'Property Address' },\n  { name: 'propertyCity', title: 'Property City' },\n  { name: 'propertyState', title: 'Property State' },\n  { name: 'managementOrCobrokeCompany', title: 'Mgmt/Co-Broke Co.' },\n  { name: 'rentOrSalePrice', title: 'Rent/Sale Price' },\n  { name: 'deductionsTotal', title: 'Deductions Total' },\n  { name: 'paymentsTotal', title: 'Payments Total' },\n  { name: 'netPaymentsTotal', title: 'Net Payments Total' },\n  { name: 'bonusPercentageAddedByAdmin', title: \"Agent's Bonus %\" },\n  { name: 'netAgentCommission', title: 'Net Agent Commission' },\n  { name: 'netCompanyCommission', title: 'Net Company Commission' },\n  { name: 'coBrokeringAgent', title: 'Co-Brokering Agent' },\n  { name: 'status', title: 'Status' },\n  { name: 'view', title: 'View' },\n];\n\n@observer\nclass DealsTableContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      tableIsLoading: true,\n      selection: [],\n    };\n  }\n\n  createRows = () => this.props.deals.map(deal => {\n    const {\n      dealID,\n      date,\n      agentName,\n      agentType,\n      leadSource,\n      dealType,\n      propertyAddress,\n      state,\n      city,\n      apartmentNumber,\n      managementOrCobrokeCompany,\n      price,\n      clientName,\n      clientEmail,\n      paymentsTotal,\n      deductionsTotal,\n      total,\n      status,\n      bonusPercentageAddedByAdmin,\n      netAgentCommission,\n      netCompanyCommission,\n      deductionItems,\n    } = deal;\n\n    const coBrokeAgents = deductionItems && deductionItems\n      .filter(v => v.deductionType === 'Co-Brokering Split' && v.agentID)\n      .map(v => v.name)\n      .join(', ');\n\n    return {\n      dealID,\n      date: moment(date).format('MM/DD/YYYY'),\n      agentName,\n      agentType: `${agentType}%`,\n      dealType,\n      clientName,\n      clientEmail,\n      propertyAddress,\n      propertyCity: city,\n      propertyState: state,\n      managementOrCobrokeCompany,\n      rentOrSalePrice: `$${padStringToDecimalString(\n        Number(price || 0).toLocaleString()\n      )}`,\n      deductionsTotal: `$${padStringToDecimalString(\n        Number(deductionsTotal || 0).toLocaleString()\n      )}`,\n      paymentsTotal: `$${padStringToDecimalString(\n        Number(paymentsTotal || 0).toLocaleString()\n      )}`,\n      netPaymentsTotal: `$${padStringToDecimalString(\n        Number(total || 0).toLocaleString()\n      )}`,\n      bonusPercentageAddedByAdmin:\n          status === 'pending'\n            ? undefined\n            : `%${bonusPercentageAddedByAdmin || 0}`,\n      netAgentCommission:\n          status === 'pending'\n            ? undefined\n            : `$${padStringToDecimalString(\n              Number(netAgentCommission || 0).toLocaleString()\n            )}`,\n      netCompanyCommission:\n          status === 'pending'\n            ? undefined\n            : `$${padStringToDecimalString(\n              Number(netCompanyCommission || 0).toLocaleString()\n            )}`,\n      coBrokeringAgent: coBrokeAgents,\n      status: capitalize(status),\n      view: {\n        type: 'action',\n        onClick: () => debounce(\n          this.props.openDealsViewDialogBox.bind(null, dealID, status),\n          1000,\n          true\n        )(),\n      },\n    };\n  });\n\n  convertDealsToCSV = () => {\n    const { deals } = this.props;\n    const { selection } = this.state;\n\n    console.log(selection);\n    console.log(deals);\n\n    if (!selection || !selection.length) return;\n\n    const csvContent = Papa.unparse(\n      deals.filter(deal => selection.includes(deal.dealID)).map(deal => ({\n        ...deal,\n        date: moment(deal.date).format('MM/DD/YYYY'),\n      })),\n      {\n        header: true,\n      }\n    );\n\n    if (this._csvLink) {\n      this._csvLink.setAttribute(\n        'href',\n        `data:text/csv;charset=utf-8,${encodeURIComponent(csvContent)}`\n      );\n      this._csvLink.setAttribute('download', 'deals_data.csv');\n      this._csvLink.click();\n    }\n  };\n\n  changeSelection = selection => {\n    this.setState({ selection });\n  };\n\n  render() {\n    const { tableIsLoading, selection } = this.state;\n    const { classes, small, ...rest } = this.props;\n    return (\n      <div className={classes.root}>\n        {tableIsLoading ? (\n          <div\n            className={classes.progressWrapper}\n            style={{\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n              height: 'calc(100vh - 180px)',\n            }}\n          >\n            <Loader color=\"#f44336\" loading />\n          </div>\n        ) : null}\n        <AdminAreaDealsTable\n          {...rest}\n          changeSelection={this.changeSelection}\n          selection={selection}\n          convertDealsToCSV={this.convertDealsToCSV}\n          small={small}\n          onMount={() => tableIsLoading ? this.setState({ tableIsLoading: false }) : null\n          }\n          columns={columns}\n          rows={this.createRows()}\n        />\n        <a\n          href=\"#\"\n          id=\"csvLink\"\n          ref={ref => (this._csvLink = ref)}\n          style={{\n            visibility: 'hidden',\n            position: 'absolute',\n            poniterEvents: 'none',\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nexport default withStyles(styles)(DealsTableContainer);\n\n\n\n// WEBPACK FOOTER //\n// src/containers/AdminAreaDealsTableContainer.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAVA;AAAA;AACA;AA0BA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAGA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0BA;AACA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAGA;AAGA;AAGA;AAIA;AAMA;AAMA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAFA;AA1CA;AAmDA;AAlFA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4FA;AAAA;AAIA;AACA;AAEA;AAEA;AACA;AAAA;AAAA;AAEA;AAFA;AAAA;AAKA;AADA;AACA;AAIA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAvHA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0HA;AAAA;AAAA;AACA;AA3HA;AAEA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;AAsHA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAYA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAJA;AAAA;AAAA;AAAA;AAAA;AAYA;;;;;;;;;;;AAvKA;AACA;AAyKA;AACA;AADA;;;;;;;;;;;;AAhOA;AAEA;AA2BA;AAyBA;;;;;;;;;;A","sourceRoot":""}