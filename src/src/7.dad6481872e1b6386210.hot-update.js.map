{"version":3,"file":"7.dad6481872e1b6386210.hot-update.js","sources":["webpack:///src/containers/EditProfilePicForm.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { observer } from 'mobx-react';\nimport axios from 'axios';\nimport EditProfilePicForm from '../components/forms/EditProfilePicForm';\nimport { round } from '../utils/Math';\nimport getProfilePicSignedURL from '../effects/getProfilePicSignedURL';\nimport setAgentProfilePic from '../effects/users/setAgentProfilePic';\n\n@observer\nclass EditProfilePicFormContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      imageFile: '',\n      imageFileConfirmed: false,\n      confirmedImageDataURL: null,\n      imageScale: 0,\n      adjustedImageScale: 1,\n      loadingSetImg: false,\n      uplodingImageProgress: 0,\n      isUploadingImage: false,\n      formSubmitedSuccessfully: false,\n      imageBlob: null,\n      submittingFormToServer: false,\n    };\n  }\n\n  setImageFile = file => {\n    this.setState({ imageFile: file });\n  };\n\n  clearImageFile = () => {\n    this.setState({\n      imageFile: '',\n      imageFileConfirmed: false,\n      confirmedImageDataURL: null,\n    });\n\n    if (this._fileUploadInput) {\n      this._fileUploadInput.value = null;\n    }\n  };\n\n  getFileUploadInput = input => {\n    this._fileUploadInput = input;\n  };\n\n  getProfilePicEditor = editor => {\n    this._profilePicEditor = editor;\n  };\n\n  setImageScale = num => {\n    const rawScale = Number(num);\n    const adjustedImageScale = round(1 + rawScale / 100, 2);\n    this.setState({ imageScale: rawScale, adjustedImageScale });\n  };\n\n  confirmImageFile = () => {\n    if (this._profilePicEditor) {\n      // This returns a HTMLCanvasElement, it can be made into a data URL or a blob,\n      // drawn on another canvas, or added to the DOM.\n      const canvas = this._profilePicEditor.getImage();\n\n      canvas.toBlob(blob => {\n        this.setState({\n          imageBlob: blob,\n          imageFileConfirmed: true,\n          loadingSetImg: true,\n          confirmedImageDataURL: URL.createObjectURL(blob),\n        });\n      });\n\n      // If you want the image resized to the canvas size (also a HTMLCanvasElement)\n      // const canvasScaled = this._profilePicEditor.getImageScaledToCanvas();\n    }\n  };\n\n  setFinishedLoadingImg = () => {\n    this.setState({ loadingSetImg: false });\n  };\n\n  onSubmit = (values, e, formApi) => {\n    const { imageFile, imageFileConfirmed, imageBlob } = this.state;\n    if (!imageFile || !imageFileConfirmed) return;\n    this.props.setFormSubmitted();\n\n    const returnValues = {\n      fileName: imageFile.name,\n      fileType: imageFile.type,\n      uuid: this.props.uuid,\n    };\n\n    console.log(returnValues);\n\n    this.setState({\n      submittingFormToServer: true,\n    });\n\n    this.props.toggleSubmittingEditProfilePicForm(true);\n\n    getProfilePicSignedURL(returnValues)\n      .then(result => {\n        const { item, error } = result;\n\n        let hasError;\n\n        if (error) {\n          console.log(error);\n          hasError = true;\n        }\n\n        if (!item && item[0] && item[0].error) {\n          console.log(item[0].error);\n          hasError = true;\n        }\n\n        if (hasError) {\n          this.setState({\n            submittingFormToServer: false,\n          });\n          this.props.openRequestErrorSnackbar();\n          this.props.toggleSubmittingEditProfilePicForm(false);\n          this.props.setFormSubmitted(false);\n          return;\n        }\n\n        if (item[0].signedURL) {\n          axios\n            .put(item[0].signedURL, imageBlob, {\n              headers: {\n                'Content-Type': this.state.imageFile.type,\n              },\n              onUploadProgress: progressEvent => {\n                // Do whatever you want with the native progress event\n                const loadedPercent =\n                  (progressEvent.loaded / progressEvent.total) * 100;\n                this.setState({\n                  formSubmitedSuccessfully: true,\n                  submittingFormToServer: Math.floor(loadedPercent)\n                    ? false\n                    : true,\n                  uplodingImageProgress: Math.floor(loadedPercent),\n                  isUploadingImage: loadedPercent >= 100 ? false : true,\n                });\n              },\n            })\n            .then(response => {\n              const status = `${response.status}`;\n              const okRegex = /^[2][0-9][0-9]$/;\n\n              if (!okRegex.test(status)) {\n                this.setState({\n                  isUploadingImage: false,\n                });\n                this.props.setFormSubmitted(false);\n\n                if (this.props.openRequestErrorSnackbar) {\n                  this.props.openRequestErrorSnackbar(\n                    'There was an error uploading your file. Please try again shortly.'\n                  );\n                }\n\n                return;\n              }\n\n              setAgentProfilePic(this.props.uuid, item[0].fileName).then(\n                res => {\n                  console.log(`data url: ${this.state.confirmedImageDataURL}`);\n                  this.props.setFinishedSubmittingForm(\n                    this.state.confirmedImageDataURL\n                  );\n                  this.props.setFormSubmitted(false);\n                }\n              );\n            });\n        }\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          submittingFormToServer: false,\n        });\n        this.props.openRequestErrorSnackbar(\n          'There was an error uploading your image.'\n        );\n        this.props.setFormSubmitted(false);\n        this.props.toggleSubmittingEditProfilePicForm(true);\n      });\n  };\n\n  onSubmitFailure(errs, onSubmitError) {\n    console.log(errs);\n    console.log(onSubmitError);\n    this.props.setFormSubmitted(false);\n  }\n\n  render() {\n    const { classes, ...rest } = this.props;\n    return (\n      <div style={{ width: '100%' }}>\n        <EditProfilePicForm\n          submittingFormToServer={this.state.submittingFormToServer}\n          onSubmit={this.onSubmit}\n          onSubmitFailure={this.onSubmitFailure}\n          setImageFile={this.setImageFile}\n          imageFile={this.state.imageFile}\n          imageScale={this.state.imageScale}\n          setImageScale={this.setImageScale}\n          adjustedImageScale={this.state.adjustedImageScale}\n          getFileUploadInput={this.getFileUploadInput}\n          clearImageFile={this.clearImageFile}\n          getProfilePicEditor={this.getProfilePicEditor}\n          imageFileConfirmed={this.state.imageFileConfirmed}\n          confirmImageFile={this.confirmImageFile}\n          confirmedImageDataURL={this.state.confirmedImageDataURL}\n          loadingSetImg={this.state.loadingSetImg}\n          setFinishedLoadingImg={this.setFinishedLoadingImg}\n          uplodingImageProgress={this.state.uplodingImageProgress}\n          formSubmitedSuccessfully={this.state.formSubmitedSuccessfully}\n          isUploadingImage={this.state.isUploadingImage}\n          getFormApi={formApi => {\n            console.log(formApi);\n            this._formApi = formApi;\n          }}\n          {...rest}\n        />\n      </div>\n    );\n  }\n}\n\nexport default EditProfilePicFormContainer;\n\n\n\n// WEBPACK FOOTER //\n// src/containers/EditProfilePicForm.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAkBA;AAAA;AAAA;AACA;AAnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsBA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AACA;AA/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCA;AACA;AAnCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsCA;AACA;AAvCA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0CA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AA7CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAGA;AACA;AACA;AAjEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoEA;AAAA;AAAA;AACA;AArEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AANA;AAQA;AAhBA;AAmBA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AADA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAlLA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAFA;AAeA;AACA;;;AAoKA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4BA;;;;;;;;;;;AA3NA;AACA;AA6NA;AAAA;;;;;;;;;;;;AA9NA;;;;;;;;;;A","sourceRoot":""}